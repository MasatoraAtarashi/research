# コーディングエージェント追加調査項目

このドキュメントでは、初回調査で完了していない項目について、今後の調査方針と重要な調査ポイントをまとめています。

## 未調査項目一覧

### 1. テスト実装の方法と内容

#### 調査対象
- 各プロジェクトのテストフレームワーク
- テストカバレッジ
- テスト戦略（単体テスト、統合テスト、E2Eテスト）
- モックとスタブの使用方法
- CI/CDパイプラインでのテスト実行

#### 重要な調査ポイント
- **OpenCode**: Go標準のtestingパッケージ使用状況、testifyライブラリの活用
- **Gemini CLI**: Vitestの設定、統合テストの実装方法
- **cat-code**: テスト実装の有無と方針

#### 調査すべきファイル
```
opencode/*_test.go
gemini-cli/packages/*/test/
gemini-cli/integration-tests/
cat-code/src/**/*.spec.ts または *.test.ts
```

### 2. アーキテクチャ設計

#### 調査対象
- 全体的なシステム設計
- レイヤー構造とモジュール分割
- 依存関係の管理
- デザインパターンの使用
- 拡張性とメンテナビリティの考慮

#### 重要な調査ポイント
- **OpenCode**: internal/パッケージの構造、インターフェース設計
- **Gemini CLI**: モノレポ構造、core/cliの責任分離
- **cat-code**: シンプルアーキテクチャの利点と制限

#### アーキテクチャドキュメント
```
opencode/docs/architecture.md (存在する場合)
gemini-cli/docs/architecture.md
各プロジェクトのREADME.md
```

### 3. エージェントのロジック実装

#### 調査対象
- メッセージ処理フロー
- ツール選択アルゴリズム
- コンテキスト管理
- 状態管理とステートマシン
- エラーハンドリング戦略

#### 重要な調査ポイント
- **OpenCode**: agent.goでのメッセージストリーム処理
- **Gemini CLI**: ツールスケジューラーの実装
- **cat-code**: 猫の応答ロジックとファイル編集の統合

#### 主要ファイル
```
opencode/internal/llm/agent/agent.go
gemini-cli/packages/core/src/core/coreToolScheduler.ts
cat-code/src/lib/cat.ts
```

### 4. セッション管理の実装

#### 調査対象
- セッションの作成・更新・削除
- セッション状態の永続化
- 複数セッションの管理
- セッションメタデータ
- セッション履歴の保存

#### 重要な調査ポイント
- **OpenCode**: SQLiteデータベースでのセッション管理
- **Gemini CLI**: セッション状態の保持方法
- **cat-code**: ステートレスな設計

#### データベース/ストレージ
```
opencode/internal/session/
opencode/internal/db/sessions.sql
gemini-cli のセッション関連ファイル
```

### 5. キャッシュ機能の実装

#### 調査対象
- キャッシュ戦略（何をキャッシュするか）
- キャッシュの有効期限管理
- メモリキャッシュ vs ディスクキャッシュ
- キャッシュ無効化戦略
- パフォーマンスへの影響

#### 重要な調査ポイント
- **OpenCode**: プロンプトキャッシュ、LSP診断キャッシュ
- **Gemini CLI**: EditCorrectorのLRUキャッシュ、トークンキャッシュ
- **cat-code**: キャッシュ実装の有無

#### キャッシュ関連ファイル
```
opencode でのキャッシュ実装
gemini-cli/packages/cli/src/utils/tokenCache.ts
gemini-cli/packages/core/src/utils/editCorrector.ts
```

### 6. 履歴管理の実装

#### 調査対象
- メッセージ履歴の保存
- ファイル変更履歴
- コマンド実行履歴
- 履歴の検索・フィルタリング
- 履歴の圧縮・アーカイブ

#### 重要な調査ポイント
- **OpenCode**: history.Serviceの実装、SQLiteでの履歴保存
- **Gemini CLI**: 履歴圧縮システム、XML形式での保存
- **cat-code**: 履歴機能の有無

#### 履歴管理ファイル
```
opencode/internal/history/
opencode/internal/db/messages.sql
gemini-cli の履歴圧縮関連ファイル
```

## 調査方法の提案

### 1. 静的解析
- ソースコードの直接調査
- 依存関係グラフの作成
- コードメトリクスの収集

### 2. 動的解析
- 実際にツールを実行してデバッグ
- プロファイリングによるパフォーマンス分析
- ログ出力の確認

### 3. ドキュメント調査
- README、設計ドキュメントの確認
- コメントとドキュメンテーションの分析
- issueとPRの調査

## 優先順位

1. **高優先度**: アーキテクチャ設計、エージェントロジック（コア機能の理解）
2. **中優先度**: セッション管理、履歴管理（データ永続化の理解）
3. **低優先度**: テスト実装、キャッシュ機能（品質と最適化の理解）

## 期待される成果

これらの追加調査により、以下の理解が深まることが期待されます：

1. **システム全体の動作フロー**: エージェントがどのようにユーザー入力を処理し、応答を生成するか
2. **データフローと状態管理**: セッション、履歴、キャッシュがどのように連携するか
3. **品質保証**: テスト戦略とカバレッジから見る各プロジェクトの成熟度
4. **拡張性**: 新機能追加やカスタマイズの容易さ
5. **パフォーマンス特性**: キャッシュとデータ管理による最適化の効果

## 次のステップ

1. 優先順位に従って調査を実施
2. 各項目について詳細な技術レポートを作成
3. 3つの実装の比較表を更新
4. ベストプラクティスと改善提案をまとめる